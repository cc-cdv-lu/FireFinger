<div class="container" [ngClass]="style.theme">
  <mat-toolbar>
    <h3>Settings</h3>
  </mat-toolbar>


  <mat-accordion>

    <mat-expansion-panel>
      <mat-expansion-panel-header [collapsedHeight]="'4rem'" [expandedHeight]="'4rem'">
        <mat-panel-title>
          {{'settings.style.title' | translate}}
        </mat-panel-title>
        <!--
        <mat-panel-description  [style.font-size]="style.getFontSize(SIZE.SMALLER)" [style.color]="style.activeColorScheme.prev">
          {{'settings.style.description' | translate}}
        </mat-panel-description>
      -->
      </mat-expansion-panel-header>


      <section class="section">
        <h2>{{'settings.style.colorscheme' | translate}}</h2>
        <!--
        <div *ngFor="let c of style.colorSchemes">
          <button mat-raised-button (click)="style.activeColorScheme = c" [style.color]="c.current" [style.backgroundColor]="c.backgroundColor" [style.border]="c == style.activeColorScheme ? '8px solid primary' : '0px'">{{c.name}}</button>
        </div>
      -->
      </section>

      <section class="section">
        <button mat-raised-button color="primary" *ngFor="let theme of style.themes" (click)="changeTheme(theme.id)">{{theme.name}}</button>
      </section>

      <section class="section">
        <h2>{{'settings.style.fontsize' | translate}}</h2>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="style.fontSize" min="50" max="1100" step="1"></mat-slider>
      </section>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header [collapsedHeight]="'4rem'" [expandedHeight]="'4rem'">
        <mat-panel-title>
          {{'settings.application.title' | translate}}
        </mat-panel-title>
        <!--
        <mat-panel-description  [style.font-size]="style.getFontSize(SIZE.SMALLER)" [style.color]="style.activeColorScheme.prev">
          {{'settings.application.description' | translate}}
        </mat-panel-description>
      -->
      </mat-expansion-panel-header>


      <section class="section">
        <h2>{{'settings.application.files.title' | translate}}</h2>
        <p>{{'settings.application.files.description' | translate}}</p>
        <button mat-raised-button color="primary" (click)="lessons.openDocsFolderInExplorer()">{{'settings.application.files.button' | translate}}</button>
      </section>

      <section class="section">
        <h2>{{'settings.application.lang.title' | translate}}</h2>
        <p>{{'settings.application.lang.description' | translate}}</p>

        <mat-form-field>
          <mat-select placeholder="Language" [(value)]="lang" (selectionChange)="onLangChange()">
            <mat-option *ngFor="let l of langs" [value]="l.id">
              {{ l.description }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </section>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header [collapsedHeight]="'4rem'" [expandedHeight]="'4rem'">
        <mat-panel-title>
          {{'settings.voice.title' | translate}}
        </mat-panel-title>
        <!--
        <mat-panel-description  [style.font-size]="style.getFontSize(SIZE.SMALLER)" [style.color]="style.activeColorScheme.prev">
          {{'settings.voice.description' | translate}}
        </mat-panel-description>
      -->
      </mat-expansion-panel-header>


      <section class="section">

        <h2>{{'settings.voice.control.title' | translate}}</h2>
        <mat-grid-list cols="2" rowHeight="60px">
          <mat-grid-tile>
            <form class="example-form">
              <mat-form-field class="example-full-width">
                <input matInput placeholder="Enter test phrase" [(ngModel)]="reader.config.test" [ngModelOptions]="{standalone: true}">
              </mat-form-field>
            </form>
          </mat-grid-tile>
          <mat-grid-tile>
            <button mat-raised-button color="primary" (click)="reader.save()">{{'settings.voice.control.save' | translate}}</button>
          </mat-grid-tile>
          <mat-grid-tile>
            <button mat-raised-button color="primary" (click)="readTest()">{{'settings.voice.control.test' | translate}}</button>
          </mat-grid-tile>
        </mat-grid-list>

        <h2>{{'settings.voice.variant' | translate}}</h2>
        <mat-grid-list cols="2" rowHeight="60px">
          <mat-grid-tile>
            <mat-form-field>
              <mat-select placeholder="Speaking voice" [(value)]="reader.config.options.variant">
                <mat-option *ngFor="let variant of reader.variants" [value]="variant.id">
                  {{ variant.description }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-grid-tile>
          <mat-grid-tile>
            <mat-form-field>
              <mat-select placeholder="Speaking language" [(value)]="reader.config.voice" (selectionChange)="onVoiceChange()">
                <mat-option *ngFor="let voice of reader.voices" [value]="voice.url">
                  {{ voice.description }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-grid-tile>
        </mat-grid-list>




        <h2>{{'settings.voice.other.amplitude.title' | translate}}</h2>
        <p>{{'settings.voice.other.amplitude.description' | translate}}</p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.amplitude" min="50" max="200" step="1"></mat-slider>

        <h2>{{'settings.voice.other.pitch.title' | translate}}</h2>
        <p>{{'settings.voice.other.pitch.description' | translate}}</p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.pitch" min="50" max="200" step="1"></mat-slider>

        <h2>{{'settings.voice.other.speed.title' | translate}}</h2>
        <p>{{'settings.voice.other.speed.description' | translate}}</p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.speed" min="50" max="400" step="1"></mat-slider>

        <h2>{{'settings.voice.other.volume.title' | translate}}</h2>
        <p>{{'settings.voice.other.volume.description' | translate}}</p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.volume" min="0" max="1" step="0.1"></mat-slider>

        <h2>{{'settings.voice.other.capitals.title' | translate}}</h2>
        <p innerHTML="{{'settings.voice.other.capitals.description' | translate}}"></p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.capitals" min="0" max="30" step="1"></mat-slider>




      </section>
    </mat-expansion-panel>

    <mat-expansion-panel *ngIf="user.loggedInUser">
      <mat-expansion-panel-header [collapsedHeight]="'4rem'" [expandedHeight]="'4rem'">
        <mat-panel-title>
          {{'settings.user.title' | translate}}
        </mat-panel-title>
        <!--
        <mat-panel-description  [style.font-size]="style.getFontSize(SIZE.SMALLER)" [style.color]="style.activeColorScheme.prev">
          {{'settings.user.description' | translate}}
        </mat-panel-description>
      -->
      </mat-expansion-panel-header>

      <h1>{{'settings.user.stats.title' | translate}}</h1>
      <section class="section">
        <h2>{{'settings.user.stats.name' | translate}}</h2>
        <span>{{user.loggedInUser.name}}</span>
      </section>

      <section class="section">
        <h2 [style.font-size]="'4rem'">{{'settings.user.stats.laststats' | translate}}</h2>
        <b>{{'general.typingspeed' | translate}}:</b>
        <p>{{getFormat(user.loggedInUser?.lastSessionStats.typeSpeed)}}</p>
        <b>{{'settings.user.stats.mistakes' | translate}}:</b>
        <p>{{user.loggedInUser?.lastSessionStats.mistakesCount}} ({{getFormat(user.loggedInUser.lastSessionStats.mistakePercentage)}} %)</p>

        <h3>{{'settings.user.stats.mostmistakes' | translate}}</h3>
        <mat-grid-list cols="5">
          <mat-grid-tile *ngFor="let mistake of stats?.getTopMistakes(user.loggedInUser?.lastSessionStats, 10)">
            <b>{{mistake?.key}}:</b>
            <p>{{mistake?.count}}</p>
          </mat-grid-tile>
        </mat-grid-list>
      </section>

      <section class="section">
        <h2>{{'settings.user.stats.overallstats' | translate}}</h2>
        <b>{{'general.typingspeed' | translate}}:</b>
        <p>{{getFormat(user.loggedInUser.overallStats.typeSpeed)}}</p>
        <b>{{'settings.user.stats.mistakes' | translate}}:</b>
        <p>{{user.loggedInUser.overallStats.mistakesCount}} ({{getFormat(user.loggedInUser.overallStats.mistakePercentage)}} %)</p>

        <h3>{{'settings.user.stats.mostmistakes' | translate}}:</h3>
        <mat-grid-list cols="5">
          <mat-grid-tile *ngFor="let mistake of stats?.getTopMistakes(user.loggedInUser.overallStats,10)">
            <b>{{mistake?.key}}:</b>
            <p>{{mistake?.count}}</p>
          </mat-grid-tile>
        </mat-grid-list>
      </section>
    </mat-expansion-panel>
  </mat-accordion>
</div>
