<div class="container">
  <h1>Settings</h1>

  <mat-accordion>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Chapter selection
        </mat-panel-title>
        <mat-panel-description>
          General settings for the whole application
        </mat-panel-description>
      </mat-expansion-panel-header>


      <section class="section" *ngFor="let set of allLessons">
        <h2>{{set.name}}</h2>
        <mat-grid-list cols="5">
          <mat-grid-tile *ngFor="let chapter of set.chapters; let i = index">
            <button mat-raised-button (click)="session.loadSession(set, i)">{{chapter.name}}</button>
          </mat-grid-tile>
        </mat-grid-list>
      </section>
    </mat-expansion-panel>



    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Style
        </mat-panel-title>
        <mat-panel-description>
          General settings for the whole application
        </mat-panel-description>
      </mat-expansion-panel-header>


      <section class="section">
        <h2>Change color scheme</h2>
        <mat-grid-list cols="5">
          <mat-grid-tile *ngFor="let c of style.colorSchemes">
            <button mat-raised-button (click)="style.setActiveColorScheme(c)" [style.color]="c.current" [style.backgroundColor]="c.backgroundColor" [style.border]="c == style.activeColorScheme ? '8px solid red' : '0px'">{{c.name}}</button>
          </mat-grid-tile>
        </mat-grid-list>
      </section>

      <section class="section">
        <h2>Font size</h2>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="style.fontSize" min="50" max="1100" step="1"></mat-slider>
      </section>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Application settings
        </mat-panel-title>
        <mat-panel-description>
          General settings for the whole application
        </mat-panel-description>
      </mat-expansion-panel-header>


      <section class="section">
        <h2>Lesson files</h2>
        <p>Each text needs to be put into a folder with the name of the lesson. See example lesson with example texts as template.</p>
        <button mat-raised-button color="primary" (click)="lessons.openDocsFolderInExplorer()">Open folder in Explorer</button>
      </section>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Voice settings
        </mat-panel-title>
        <mat-panel-description>
          General settings for the whole application
        </mat-panel-description>
      </mat-expansion-panel-header>


      <section class="section">

        <h2>Control</h2>
        <mat-grid-list cols="2" rowHeight="60px">
          <mat-grid-tile>
            <form class="example-form">
            <mat-form-field class="example-full-width">
              <input matInput placeholder="Enter test phrase" [(ngModel)]="reader.config.test"  [ngModelOptions]="{standalone: true}">
            </mat-form-field>
          </form>
          </mat-grid-tile>
          <mat-grid-tile>
            <button mat-raised-button color="primary" (click)="readTest()">Test voice settings</button>
          </mat-grid-tile>
          <mat-grid-tile>
            <button mat-raised-button color="primary" (click)="reader.save()">Save voice settings</button>
          </mat-grid-tile>
        </mat-grid-list>

        <h2>Voice variant</h2>
        <mat-grid-list cols="2" rowHeight="60px">
          <mat-grid-tile>
            <mat-form-field>
              <mat-select placeholder="Speaking voice" [(value)]="reader.config.options.variant">
                <mat-option *ngFor="let variant of reader.variants" [value]="variant.id">
                  {{ variant.description }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-grid-tile>
          <mat-grid-tile>
            <mat-form-field>
              <mat-select placeholder="Speaking language" [(value)]="reader.config.voice" (selectionChange)="onVoiceChange()">
                <mat-option *ngFor="let voice of reader.voices" [value]="voice.url">
                  {{ voice.description }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-grid-tile>
        </mat-grid-list>




        <h2>Amplitude</h2>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.amplitude" min="50" max="200" step="1"></mat-slider>

        <h2>Pitch</h2>
        <p>Additional gap between words in 10 ms units</p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.pitch" min="50" max="200" step="1"></mat-slider>

        <h2>Speed</h2>
        <p>Words per minute</p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.speed" min="50" max="400" step="1"></mat-slider>

        <h2>Volume</h2>
        <p>Volume relative to the global volume</p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.volume" min="0" max="1" step="0.1"></mat-slider>

        <h2>Capitals</h2>
        <p>Emit click sound if word starts with capital</p>
        <p>
          1: Use a click sound to indicate when a word starts with a capital letter, or double click if word is all capitals.
        </p>
        <p>
          2: Speak the word "capital" before a word which begins with a capital letter.
        </p>
        <p>
          Other values: Increases the pitch for words which begin with a capital letter. The greater the value, the greater the increase in pitch. (eg.: 20)
        </p>
        <mat-slider thumbLabel tickInterval="1" [(ngModel)]="reader.config.options.capitals" min="0" max="30" step="1"></mat-slider>




      </section>
    </mat-expansion-panel>


    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          User Info
        </mat-panel-title>
        <mat-panel-description>
          General settings for the whole application
        </mat-panel-description>
      </mat-expansion-panel-header>

      <h1>Statistics</h1>
      <section class="section">
        <h2>Name</h2>
        <span>{{user.loggedInUser.name}}</span>
      </section>

      <section class="section">
        <h2>Last session stats</h2>
        <b>Typespeed:</b> {{getFormat(user.loggedInUser.lastSessionStats.typeSpeed)}}
        <b>Mistakes:</b>{{user.loggedInUser.lastSessionStats.mistakesCount}} ({{getFormat(user.loggedInUser.lastSessionStats.mistakePercentage)}} %)

        <h3>Most mistakes:</h3>
        <mat-grid-list cols="5">
          <mat-grid-tile *ngFor="let mistake of stats.getTopMistakes(user.loggedInUser.lastSessionStats, 10)">
            <b>{{mistake?.key}}:</b> {{mistake?.count}}
          </mat-grid-tile>
        </mat-grid-list>
      </section>

      <section class="section">
        <h2>Overall stats</h2>
        <b>Typespeed:</b> {{getFormat(user.loggedInUser.overallStats.typeSpeed)}}
        <b>Mistakes:</b>{{user.loggedInUser.overallStats.mistakesCount}} ({{getFormat(user.loggedInUser.overallStats.mistakePercentage)}} %)

        <h3>Most mistakes:</h3>
        <mat-grid-list cols="5">
          <mat-grid-tile *ngFor="let mistake of stats.getTopMistakes(user.loggedInUser.overallStats,10)">
            <b>{{mistake?.key}}:</b> {{mistake?.count}}
          </mat-grid-tile>
        </mat-grid-list>
      </section>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Manual navigation
        </mat-panel-title>
        <mat-panel-description>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <section class="section">
        <mat-grid-list cols="5">
          <mat-grid-tile>
            <nav><a mat-raised-button color="primary" routerLink="/levels">Levels</a></nav>
          </mat-grid-tile>
          <mat-grid-tile>
            <nav><a mat-raised-button color="primary" routerLink="/login">login</a></nav>
          </mat-grid-tile>
          <mat-grid-tile>
            <nav> <a mat-raised-button color="primary" routerLink="/settings">Settings</a></nav>
          </mat-grid-tile>
        </mat-grid-list>
      </section>
    </mat-expansion-panel>


  </mat-accordion>
</div>
